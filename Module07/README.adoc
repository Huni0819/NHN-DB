= Model 07. 보안과 뷰

== 데이터베이스 보안 개요
---
* 안전한 데이터베이스 응용을 설계할 때 고려하는 목표
** 보안(Security) +
정보가 권한 없는 사용자에게 누출되어서는 안된다.
** 무결성 (Integrity) +
권한이 있는 사용자에 대해서만 데이터 수정이 허용되어야 한다.
** 가용성 (Availability) +
권한 있는 사용자의 접근이 거부되어서는 안된다.


=== User 개체
* 데이터베이스 관리 시스템은 시스템에 대한 모든 권한을 가지는 관리 사용자를 생성한다.
* DBMS에 따라 세분화 될 수 있으며 DBMS마다 방식이 다르다.
* DBMS는 데이터베이스에서 사용자를 생성하고 관리할 수 있는 기능들을 제공한다.
* 사용자는 DBMS 내에서 독립적으로 운영관리되나, 때때로 운영체제와 통합되거나 전사적인 디렉토리 서비스 시스템과 통합되기도 한다.
* 데이터베이스의 사용자는 개체와 데이터에 대한 보안의 주체가 되며, 데이터베이스 개체에 대한 접근/삭제/갱신에 대한 권한이 부여된다.

[source, sql]
----
 CREATE USER <User ID> IDENTIFIED BY <Password>
----

=== 접근 제어
* 대부분의 DB 사용자들은 자신의 업무를 수행하는데 필요한 데이터에만 접근한다.
* 재량 접근 제어 (Discretionary Access Control)
** 특권 (Privileges)이라는 접근 권한의 개념에 기반한다. 사용자에게 특권을 부여하는 매커니즘을 사용한다.
** 특권 : 한 사용자에게 어느 데이터 객체에 대한 어떤 특정 형태의 접근권을 주는 것.
** 약점 : 권한 없는 사용자가 권한있는 사용자로 하여금 민감한 데이터를 유출시키도록 속일 수 있다.
* 필수 접근 제어 (Mandatory Access Control)
** 사용자 개개인에 따라서 변경할 수 없는 시스템 전반에 걸친 정책에 기반한다.
** 모든 데이터베이스 객체를 판독하거나 기록하는 것에 대한 몇 가지의 규칙을 만들어 둔다.
** DBMS는 개체의 비밀 등급과 사용자의 허가 등급을 몇 가지 규칙에 따라 비교하여 사용자가 그 객체를 판독하거나 기록할 수 있는지를 결정한다.

* SQL 1999 표준은 필수 접근제어를 제공하지 않는다. 일반적으로 DBMS는 보안을 위해 재량 접근 제어를 사용한다.

=== 재량 접근 제어
* GRANT
** 사용자에게 기반 테이블이나 뷰에 대한 특권을 부여

[source, sql]
----
GRANT <특권> ON <개체> TO <사용자> [WITH GRANT OPTIONS]
----

* REVOKE
** 사용자에게 부여된 특권 부여를 취소한다.

[source, sql]
----
REVOKE <특권> ON <개체> FROM <사용자> [CASCADE]
----

* SELECT +
'개체’로 명시된 테이블의 모든 필드들을 접근(판독)할 수 있는 특권이다. 여기에는 ALTER TABLE 명령으로 나중에 추가된 필드들도 포함된다.

* INSERT (필드 이름) +
'개체' 테이블의 명세된 필드에 값을 넣은 투플을 삽입할 수 있는 특권이다. 나중에 추가되는 필드들을 포함하여 모든 필드에 대해 이 권한을 허가하려면 단순히 INSERT로 지정하면 된다.

* UPDATE (필드 이름) +
'개체' 테이블의 명세된 필드에 값을 넣은 투플의 컬럼을 갱신할 수 있는 특권이다. 나중에 추가되는 필드들을 포함하여 모든 필드에 대해 이 권한을 허가하려면 단순히 UPDATE로 지정하면 된다.

* DELETE +
'개체' 테이블로부터 투플들을 삭제할 수 있는 특권이.

* REFERENCES(필드 이름) +
'개체’라는 테이블의 명세된 필드를 참조하는 외래 키를 (다른 테이블에서) 정의할 수 있는 특권이다. 단순히 REFERENCES라고 표기하면 나중에 추가되는 것들을 포함해서 모든 필드에 대해 이 특권을 부여한다.

=== 특권
* 특정 조치 또는 작업을 실행하는 데 필요한 권한.
* 권한이 부여된 사용자에는 개체를 작성하고, 소유한 개체에 접근하며, GRANT 문을 사용해 소유한 개체에 대한 권한을 다른 사용자에게 전달할 수 있다.

=== 필수 특권 제어
* 재량 접근 제어는 일반적으로 효과가 있지만 몇 가지 약점이 존재한다.
** 권한 없는 불순한 사용자가 권한 있는 사용자로 부터 민감한 데이터를 유출할 수 있도록 속일 수 있다.
** 트로이 목마 방식에 취약하다.

* 필수 접근 제어는 필수 데이터베이스 개체에 각각의 보안 등급을 지정한다.
** 테이블, 뷰, 튜플, 필드 등 모든 개체는 개별 보안 등급을 가진다.
* 모든 주체는 보안 등급에 해당하는 허가 등급이 지정된다.
** 사용자, 프로그램 등의 주체는 허가 등급보다 높은 보안 등급을 가진 개체에 접근이 불가하다.

==== Bell-LaPudla 모델
* 개체 (테이블, 뷰, 튜블, 필드 등), 주체 (사용자, 프로그램 등), 보안 등금 (Secure Class), 허가 등급 (Clearance) 로 표현 된다.
* 모든 데이터베이스 개체에는 각각의 보안 등급이 적용되며 모든 주체들에는 보안 등급에 해당하는 허가 등급이 지정된다.

*TS(Top Secret) > S > C > U*

* 단순 보안 성질 +
주체 S가 개체 O를 판독하는 것은 class(S) >= class(O)인 경우에만 가능합니다. 예를 들어 TS등급의 사용자는 C등급의 테이블을 볼 수 있지만 C 등급의 사용자는 TS등급의 사용자를 볼 수 없습니다.

* 성질 +
주체 S가 객체 O를 기록하는 것은 class(S) ⇐ class(O)인 경우에만 가능합니다. S 등급의 사용자는 S등급이나 TS등급의 사용자만 가능합니다.

== 뷰
* 뷰(View) 는 저장장치에 물리적으로 존재하지 않지만 사용자에게 있는 것 처럼 간주되는, 하나 이상의 테이블로부터 유도된 가상의 테이블로, 데이터의 논리적 독립성을 제공하는 데이터베이스 개체/

=== View
* 관계 데이터베이스 관리 시스템의 매우 강력한 기능
* 접근 제어를 향상시키며, 논리적 데이터 독립성을 제공한다.
** 데이터 베이스 개념 스키마의 변경을 외부 사용자에게 감추는 역할이다.
** 보안 관점에서만 작성된 개체는 아니다.
* 테이블과 같은 방식으로 동작, BUT 소속 튜플이 실제로 데이터베이스에 저장된 것은 아니다.
* 필요할 때 마다 뷰 정의에 따라 계산된다.
* 질의를 생성하거나 다른 뷰를 생성할 때 기본 뷰는 테이블과 같은 형태로 사용할 수 있다.

=== 뷰 생성과 삭제
* DDL문을 이용해 생성한다.
* 읽기 전용 또는 업데이트 가능 상태로 정의한다.

==== 생성
[source, sql]
----
CREATE VIEW <뷰 이름>
AS
<쿼리 식>
----

==== 제거
[source, sql]
----
DROP VIEW <뷰 이름>
----

****
뷰를 생성할 때는 같은 이름의 속성 값이 존재해서는 안된다 ‼️
****

=== 뷰에 대한 갱신
* 사용자는 뷰와 기반 테이블을 갱신할 필요가 없어야 한다.
* SQL 92 표준
** 하나의 기반 테이블에 대해서 셀렉션 및 프로젝션 만으로 진행되고 집단 연산을 사용하지 않는 뷰에 대해서만 갱신을 허용한다.
** 갱신 가능 뷰 (Updateable View)

*** 뷰에 데이터가 들어갈 때 기반 테이블의 조건을 지킨다면 들어갈 수 있다.